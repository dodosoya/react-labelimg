(this["webpackJsonpreact-labelimg"]=this["webpackJsonpreact-labelimg"]||[]).push([[0],{532:function(e,t,a){},533:function(e,t,a){},622:function(e,t,a){},623:function(e,t,a){"use strict";a.r(t);a(331),a(343);var n=a(0),l=a.n(n),c=a(37),r=a.n(c),s=(a(532),a(125)),i=a(69),o=(a(533),a(625)),u=a(80),d=a.n(u),h=a(116),p=a(55),S=a(323),b=a(65),j=a(12),x=a(43),E={SET_IMAGE_FILES:"SET_IMAGE_FILES",SET_SEL_DRAW_IMAGE_INDEX:"SET_SEL_DRAW_IMAGE_INDEX",SET_IMAGE_SIZES:"SET_IMAGE_SIZES",SET_SEL_IMAGE_INDEXES:"SET_SEL_IMAGE_INDEXES",SET_DRAW_STATUS:"SET_DRAW_STATUS",SET_SEL_SHPAE_TYPE:"SET_SEL_SHPAE_TYPE",SET_LABELBOX_STATUS:"SET_LABELBOX_STATUS",SET_XML_PREVIEW_BOX_STATUS:"SET_XML_PREVIEW_BOX_STATUS",SET_URL_BOX_STATUS:"SET_URL_BOX_STATUS",SET_CURRENT_SHAPE:"SET_CURRENT_SHAPE",SET_SHAPES:"SET_SHAPES",SET_SEL_SHAPE_INDEX:"SET_SEL_SHAPE_INDEX",SET_LABEL_TYPES:"SET_LABEL_TYPES",SET_SEL_LABEL_TYPE:"SET_SEL_LABEL_TYPE",DELETE_SEL_SHAPE:"DELETE_SEL_SHAPE",DELETE_ALL_SHAPES:"DELETE_ALL_SHAPES"},f="IDLE",O="DRAWING",y="SELECT",_="IDLE",g="CREATE",m="UPDATE",T="rectangle",I="polygon",v=[{value:T,label:"Rectangle"},{value:I,label:"Polygon"}],w="labels",A=["jpg","jpeg","png"],L=function(e,t){var a=t.type,n=t.payload;switch(a){case E.SET_IMAGE_FILES:return Object(j.a)(Object(j.a)({},e),{},{imageFiles:n.imageFiles,selDrawImageIndex:n.selDrawImageIndex,selImageIndexes:[],imageSizes:n.imageSizes,drawStatus:n.drawStatus,currentShape:null,shapes:n.shapes,selShapeIndex:n.selShapeIndex});case E.SET_SEL_DRAW_IMAGE_INDEX:return Object(j.a)(Object(j.a)({},e),{},{selDrawImageIndex:n.selDrawImageIndex,drawStatus:f,currentShape:null,selShapeIndex:null});case E.SET_IMAGE_SIZES:return Object(j.a)(Object(j.a)({},e),{},{imageSizes:n.imageSizes,drawStyle:n.drawStyle});case E.SET_SEL_IMAGE_INDEXES:return Object(j.a)(Object(j.a)({},e),{},{selImageIndexes:n.selImageIndexes});case E.SET_DRAW_STATUS:return Object(j.a)(Object(j.a)({},e),{},{drawStatus:n.drawStatus});case E.SET_SEL_SHPAE_TYPE:return Object(j.a)(Object(j.a)({},e),{},{selShapeType:n.selShapeType});case E.SET_LABELBOX_STATUS:return Object(j.a)(Object(j.a)({},e),{},{selLabelType:n.selLabelType,labelBoxVisible:n.labelBoxVisible,labelBoxStatus:n.labelBoxStatus});case E.SET_XML_PREVIEW_BOX_STATUS:return Object(j.a)(Object(j.a)({},e),{},{selPreviewIndex:n.selPreviewIndex,xmlPreviewBoxVisible:n.xmlPreviewBoxVisible});case E.SET_URL_BOX_STATUS:return Object(j.a)(Object(j.a)({},e),{},{urlBoxVisible:n.urlBoxVisible});case E.SET_CURRENT_SHAPE:return Object(j.a)(Object(j.a)({},e),{},{currentShape:n.currentShape});case E.SET_SHAPES:return Object(j.a)(Object(j.a)({},e),{},{currentShape:null,shapes:n.shapes});case E.SET_SEL_SHAPE_INDEX:return Object(j.a)(Object(j.a)({},e),{},{drawStatus:null===n.selShapeIndex?f:y,shapes:e.shapes.map((function(t,a){return a!==e.selDrawImageIndex?t:t.map((function(e,t){var a=Object(x.cloneDeep)(e);return a.isSelect=t===n.selShapeIndex,a}))})),selShapeIndex:n.selShapeIndex});case E.SET_LABEL_TYPES:return Object(j.a)(Object(j.a)({},e),{},{labelTypes:n.labelTypes});case E.SET_SEL_LABEL_TYPE:return Object(j.a)(Object(j.a)({},e),{},{selLabelType:n.selLabelType});case E.DELETE_SEL_SHAPE:return Object(j.a)(Object(j.a)({},e),{},{drawStatus:f,shapes:e.shapes.map((function(t,a){return a===e.selDrawImageIndex?t.filter((function(t,a){return a!==e.selShapeIndex})):t})),selShapeIndex:null});case E.DELETE_ALL_SHAPES:return Object(j.a)(Object(j.a)({},e),{},{drawStatus:f,currentShape:null,shapes:e.shapes.map((function(t,a){return a===e.selDrawImageIndex?[]:t})),selShapeIndex:null});default:return e}},P=a(23),D=a.n(P),C=(D.a.number,D.a.number,D.a.number,{x:D.a.number,y:D.a.number}),B=(D.a.string,D.a.bool,D.a.bool,D.a.number,D.a.arrayOf(D.a.shape(C)),D.a.string,{cursor:D.a.string,fill:D.a.string,fillOpacity:D.a.number,stroke:D.a.string,strokeWidth:D.a.number}),R=Object(j.a)(Object(j.a)({},B),{},{strokeLinecap:D.a.oneOf(["butt","round","square"]),strokeLinejoin:D.a.oneOf(["butt","round","square"]),strokeDasharray:D.a.string}),k={fill:D.a.string,fillOpacity:D.a.number,stroke:D.a.string,strokeWidth:D.a.number},M={fill:D.a.string,fontSize:D.a.number,fontWeight:D.a.string},N=(D.a.shape(B),D.a.shape(B),D.a.shape(R),D.a.shape(k),D.a.shape(M),a(4)),U=Object(n.createContext)({dispatch:function(){return null},state:null}),X=function(e){var t=e.initialState,a=e.children,l=Object(n.useReducer)(L,t),c=Object(b.a)(l,2),r=c[0],s=c[1];return Object(N.jsx)(U.Provider,{value:{state:r,dispatch:s},children:a})},H=function(){var e=Object(n.useContext)(U);if(!e)throw new Error("Cannot use `useStoreContextContext` outside of StoreContextProvider");return e},z=a(312),F=a(313),G=a.n(F),W=a(314),V=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image.jpg";return new Promise((function(a,n){var l=new Image;l.crossOrigin="anonymous",l.src=e,l.onload=function(){var e=this.width,n=this.height,l=document.createElement("canvas"),c=l.getContext("2d");l.width=e,l.height=n,c.drawImage(this,0,0),l.toBlob((function(l){a({file:new File([l],t,{type:l.type}),size:{width:e,height:n}})}),"image/jpeg",1)},l.onerror=function(){n(new Error("load image error"))}}))},Y=function(e){return new Promise((function(t,a){var n=new Image;n.src=e,n.onload=function(){var e=this.width,a=this.height;t({width:e,height:a})},n.onerror=function(){a(new Error("load image error"))}}))},Z=function(e){return{x:e.x,y:e.y}},q=function(e,t){var a=e.reduce((function(e,t,a){return 0===a?"".concat(e,"M").concat(t.x,",").concat(t.y," "):"".concat(e,"L").concat(t.x,",").concat(t.y," ")}),"");return t&&(a+="Z"),a},J=function(e){return{xmin:e.reduce((function(e,t){return e<t.x?e:t.x}),Number.MAX_SAFE_INTEGER),ymin:e.reduce((function(e,t){return e<t.y?e:t.y}),Number.MAX_SAFE_INTEGER),xmax:e.reduce((function(e,t){return e>t.x?e:t.x}),-Number.MAX_SAFE_INTEGER),ymax:e.reduce((function(e,t){return e>t.y?e:t.y}),-Number.MAX_SAFE_INTEGER)}},K=function(e){return{shapeStyle:{cursor:"pointer",fill:"#1890ff",fillOpacity:.2,stroke:"#1890ff",strokeWidth:Math.round(.004*e)},selShapeStyle:{cursor:"pointer",fill:"#ffff00",fillOpacity:.2,stroke:"#ffff00",strokeWidth:Math.round(.004*e)},drawingShapePathStyle:{fill:"#ffff00",fillOpacity:.2,stroke:"#ffff00",strokeWidth:Math.round(.004*e),strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"".concat(Math.round(.008*e),", ").concat(Math.round(.008*e))},drawingShapePointStyle:{fill:"#ffff00",fillOpacity:1,stroke:"transparent",strokeWidth:Math.round(.008*e)},labelStyle:{fill:"#000000d9",fontSize:Math.round(.02*e),fontWeight:"bold"}}},Q=function(e){var t=e.width,a=void 0===t?0:t,n=e.height,l=void 0===n?0:n,c=e.depth;return{width:a,height:l,depth:void 0===c?3:c}},$=function(e,t,a){var n=function(e){return{folder:w,filename:e.name,path:"./".concat(w,"/").concat(e.name),source:{database:"Unknown"},size:{width:0,height:0,depth:3},segmented:0,object:[]}}(e);n.size=Q(t),n.object=a.map((function(e){return function(e){return{name:e.label,pose:"Unspecified",truncated:0,difficult:0,bndbox:J(e.paths)}}(e)}));var l={annotation:n},c="";try{c=new z.j2xParser({format:!0}).parse(l)}catch(r){console.error(r.message)}return c},ee=function(e,t){var a=new G.a,n=a.folder(w);e.forEach((function(e,a){n.file(e.name,e),n.file("".concat(e.name.split(".")[0],".xml"),t[a])})),a.generateAsync({type:"blob"}).then((function(e){Object(W.saveAs)(e,"".concat(function(e){var t=e.getFullYear(),a=(e.getMonth()+1).toString(),n=1===a.length?"0".concat(a):a,l=e.getDate().toString(),c=1===l.length?"0".concat(l):l,r=e.getHours().toString(),s=1===r.length?"0".concat(r):r,i=e.getMinutes().toString(),o=1===i.length?"0".concat(i):i,u=e.getSeconds().toString(),d=1===u.length?"0".concat(u):u;return"".concat(t).concat(n).concat(c).concat(s).concat(o).concat(d)}(new Date),".zip"))}))};var te=function(){var e=H(),t=e.state,a=e.dispatch,n=t.imageFiles,l=t.selDrawImageIndex,c=t.imageSizes,r=t.drawStatus,s=t.shapes,i=t.selShapeIndex,o=function(e){var t=Object(p.a)(e.target.files).filter((function(e){return-1!==A.indexOf((t=e.name,t.trim().split(".")[1]).toLowerCase());var t}));if(0!==t.length){var o=[].concat(Object(p.a)(n),Object(p.a)(t)),u=o.map((function(e,t){return c[t]?c[t]:Q({})})),d=o.map((function(e,t){return s[t]?s[t]:[]}));a({type:E.SET_IMAGE_FILES,payload:{imageFiles:o,selDrawImageIndex:n.length?l:0,imageSizes:u,drawStatus:r,shapes:d,selShapeIndex:i}});var h=t.length>1?"".concat(t.length," images"):"".concat(t.length," image");S.b.success("Success to load ".concat(h,"."))}},u=function(){var e=Object(h.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a({type:E.SET_URL_BOX_STATUS,payload:{urlBoxVisible:!0}});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(N.jsxs)("ul",{className:"file-tool-container",children:[Object(N.jsx)("li",{children:Object(N.jsxs)("label",{children:[Object(N.jsx)("span",{children:"Open"}),Object(N.jsx)("input",{type:"file",accept:A.map((function(e){return".".concat(e)})).join(","),multiple:!0,onChange:o,style:{display:"none"}})]})}),Object(N.jsx)("li",{children:Object(N.jsxs)("label",{children:[Object(N.jsx)("span",{children:"Open Dir"}),Object(N.jsx)("input",{type:"file",accept:A.map((function(e){return".".concat(e)})).join(","),webkitdirectory:"true",directory:"true",multiple:!0,onChange:o,style:{display:"none"}})]})}),Object(N.jsx)("li",{children:Object(N.jsx)("span",{onClick:u,children:"Open URL"})}),Object(N.jsx)("li",{children:Object(N.jsx)("span",{onClick:function(){if(n.length&&!(n.length<2)){var e=l+1;e>=n.length&&(e=0),a({type:E.SET_SEL_SHAPE_INDEX,payload:{selShapeIndex:null}}),a({type:E.SET_SEL_DRAW_IMAGE_INDEX,payload:{selDrawImageIndex:e}})}},children:"Next Image"})}),Object(N.jsx)("li",{children:Object(N.jsx)("span",{onClick:function(){if(n.length&&!(n.length<2)){var e=l-1;e<0&&(e=n.length-1),a({type:E.SET_SEL_SHAPE_INDEX,payload:{selShapeIndex:null}}),a({type:E.SET_SEL_DRAW_IMAGE_INDEX,payload:{selDrawImageIndex:e}})}},children:"Prev Image"})}),Object(N.jsx)("li",{children:Object(N.jsx)("span",{onClick:function(){if(0!==n.length){var e=n.map((function(e,t){return $(e,c[t],s[t])}));ee(n,e)}else S.b.info("No images are loaded.")},children:"Save"})})]})},ae=a(632),ne=a(635),le=a(68);var ce=function(){var e=H(),t=e.state,a=e.dispatch,n=t.selDrawImageIndex,l=t.selShapeType,c=t.selShapeIndex,r=t.currentShape,o=t.shapes,u=function(){var e=Object(x.cloneDeep)(o);e[n]=e[n].map((function(e){if(!e.isSelect)return e;var t=Object(x.cloneDeep)(e);return t.isSelect=!1,t})),a({type:E.SET_SHAPES,payload:{shapes:e}}),a({type:E.SET_DRAW_STATUS,payload:{drawStatus:f}})};return Object(N.jsxs)(s.a,{type:"flex",justify:"center",gutter:[0,12],children:[Object(N.jsx)(i.a,{xs:24,style:{textAlign:"center"},children:Object(N.jsx)(ae.a.Group,{value:l,onChange:function(e){e.target.value!==l&&(a({type:E.SET_SEL_SHPAE_TYPE,payload:{selShapeType:e.target.value}}),u())},children:Object(N.jsx)(ne.b,{direction:"vertical",style:{width:"100%"},children:v.map((function(e){return Object(N.jsx)(ae.a.Button,{value:e.value,style:{width:"100%"},children:e.label},e.value)}))})})}),Object(N.jsx)(i.a,{xs:24,children:Object(N.jsx)(le.a,{type:"text",onClick:u,disabled:null===r,style:{width:"100%"},children:"Reset"})}),Object(N.jsx)(i.a,{xs:24,children:Object(N.jsx)(le.a,{type:"text",onClick:function(){a({type:E.DELETE_SEL_SHAPE})},disabled:null===c,style:{width:"100%"},children:"Clear Select"})}),Object(N.jsx)(i.a,{xs:24,children:Object(N.jsx)(le.a,{type:"text",onClick:function(){a({type:E.DELETE_ALL_SHAPES})},disabled:!o[n]||0===o[n].length,style:{width:"100%"},children:"Clear All"})})]})},re=function(){return Object(N.jsxs)(N.Fragment,{children:[Object(N.jsx)(te,{}),Object(N.jsx)(o.a,{style:{margin:"0 0 16px 0"}}),Object(N.jsx)(ce,{})]})},se=a(317),ie=function(e){var t=e.href,a=e.width,n=e.height;return Object(N.jsx)("image",{href:t,width:a,height:n,preserveAspectRatio:"xMidYMid slice"})},oe={SET_MOUSE_COORDINATE:"SET_MOUSE_COORDINATE"},ue=function(e,t){var a=t.type,n=t.payload;switch(a){case oe.SET_MOUSE_COORDINATE:return Object(j.a)(Object(j.a)({},e),{},{mouseCoordinate:n.mouseCoordinate});default:return e}},de=Object(n.createContext)({state:null,dispatch:function(){return null}}),he=function(e){var t=e.initialState,a=e.children,l=Object(n.useReducer)(ue,t),c=Object(b.a)(l,2),r=c[0],s=c[1];return Object(N.jsx)(de.Provider,{value:{state:r,dispatch:s},children:a})},pe=function(){var e=Object(n.useContext)(de);if(!e)throw new Error("Cannot use `useMouseContextContext` outside of MouseContextProvider");return e};var Se=function(){var e=Object(n.useRef)(null),t=H(),a=t.state,l=t.dispatch,c=pe(),r=c.state,s=c.dispatch,i=a.imageFiles,o=a.selDrawImageIndex,u=a.imageSizes,p=a.currentShape,S=a.drawStyle,b=a.drawStatus,_=a.selShapeType,m=a.selShapeIndex,v=a.shapes,w=a.selLabelType,A=a.closePointRegion,L=S.shapeStyle,P=S.selShapeStyle,D=S.drawingShapePathStyle,C=S.drawingShapePointStyle,B=S.labelStyle,R=r.mouseCoordinate;Object(n.useEffect)(Object(h.a)(d.a.mark((function e(){var t,a,n,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==o&&0!==i.length){e.next=2;break}return e.abrupt("return");case 2:return t=window.URL.createObjectURL(i[o]),e.prev=3,e.next=6,Y(t);case 6:a=e.sent,n=a.width,c=a.height,l({type:E.SET_IMAGE_SIZES,payload:{imageSizes:u.map((function(e,t){return t===o?Q({width:n,height:c}):e})),drawStyle:K(n>c?n:c)}}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),console.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[3,11]])}))),[i,o]);var k=function(e){var t=e.x,a=e.y;return t>=0&&t<=u[o].width&&a>=0&&a<=u[o].height};Object(n.useEffect)((function(){0!==i.length&&(k(Object(j.a)({},R))?(e.current.style.cursor="crosshair",p&&p.paths.length>0&&(_===I&&Math.abs(p.paths[0].x-R.x)<=A&&Math.abs(p.paths[0].y-R.y)<=A?e.current.style.cursor="pointer":e.current.style.cursor="crosshair")):e.current.style.cursor="not-allowed")}),[i,p,R]);var M=Object(n.useMemo)((function(){return null===o?{href:"",width:0,height:0}:{href:window.URL.createObjectURL(i[o]),width:u[o].width,height:u[o].height}}),[i,o,u]),U=function(){l({type:E.SET_DRAW_STATUS,payload:{drawStatus:f}}),e.current.style.cursor="crosshair"},X=function(e){return 0===e.button};return Object(N.jsx)("div",{className:"svg-wrapper",children:i[o]&&Object(N.jsxs)("svg",{className:"svg-container",ref:e,viewBox:"0 0 ".concat(u[o].width," ").concat(u[o].height),onMouseMove:function(t){var a=function(t){if(!t)return Z({x:0,y:0});var a=e.current.getScreenCTM();return Z(a?{x:parseInt((t.clientX-a.e)/a.a,10),y:parseInt((t.clientY-a.f)/a.d,10)}:{x:0,y:0})}(t);if(s({type:oe.SET_MOUSE_COORDINATE,payload:{mouseCoordinate:a}}),b===O||p)switch(_){case T:!function(e){var t=Object(x.cloneDeep)(p),a=t.paths[0],n=e,c={x:a.x,y:n.y},r={x:n.x,y:a.y};t.paths=[a,c,n,r,a],t.exactPathCount=t.paths.length-1,t.d=q(t.paths,!1),l({type:E.SET_CURRENT_SHAPE,payload:{currentShape:t}})}(a);break;case I:!function(e){var t=Object(x.cloneDeep)(p);t.exactPathCount===t.paths.length?t.paths.push(e):t.paths[t.paths.length-1]=e,t.d=q(t.paths,!1),l({type:E.SET_CURRENT_SHAPE,payload:{currentShape:t}})}(a)}},onMouseUp:function(e){if(X(e)&&k(Object(j.a)({},R)))if(b!==y){if(b===f){var t=function(e){var t=[e];return{label:"",visible:!0,isSelect:!1,exactPathCount:1,paths:t,d:q(t,!1)}}(R);l({type:E.SET_CURRENT_SHAPE,payload:{currentShape:t}}),l({type:E.SET_DRAW_STATUS,payload:{drawStatus:O}})}else if(b===O&&p)switch(_){case T:1!==p.exactPathCount&&(l({type:E.SET_LABELBOX_STATUS,payload:{selLabelType:w,labelBoxVisible:!0,labelBoxStatus:g}}),U());break;case I:!function(){if(p.paths.length>0&&Math.abs(p.paths[0].x-R.x)<=A&&Math.abs(p.paths[0].y-R.y)<=A){if(1===p.exactPathCount)return;l({type:E.SET_LABELBOX_STATUS,payload:{selLabelType:w,labelBoxVisible:!0,labelBoxStatus:g}}),U()}else{if(p.exactPathCount===p.paths.length)return;var e=Object(x.cloneDeep)(p);e.paths[e.paths.length-1]=Object(j.a)({},R),e.exactPathCount+=1,e.d=q(e.paths,!1),l({type:E.SET_CURRENT_SHAPE,payload:{currentShape:e}})}}()}}else l({type:E.SET_SEL_SHAPE_INDEX,payload:{selShapeIndex:null}})},children:[Object(N.jsx)(ie,Object(j.a)({},M)),p&&Object(N.jsxs)("g",{children:[Object(N.jsx)("path",{d:p.d,style:Object(j.a)({},D)}),p.paths.map((function(e){return Object(N.jsx)("circle",{cx:e.x,cy:e.y,style:Object(j.a)({},C),r:C.strokeWidth},Object(se.v4)())}))]}),v[o]&&v[o].map((function(e,t){return e.visible?Object(N.jsxs)("g",{children:[Object(N.jsx)("path",{d:e.d,style:e.isSelect?Object(j.a)({},P):Object(j.a)({},L),onMouseUp:function(e){return function(e,t){X(e)&&b!==O&&(e.stopPropagation(),l({type:E.SET_SEL_SHAPE_INDEX,payload:{selShapeIndex:t===m?null:t}}))}(e,t)}}),e.label&&Object(N.jsx)("text",{x:J(e.paths).xmin,y:J(e.paths).ymin,style:Object(j.a)({},B),children:e.label})]},e.d):null}))]})})},be=a(630),je=a(633),xe=a(636);var Ee=function(e){var t=e.index,a=e.name,n=H(),l=n.state,c=n.dispatch,r=l.imageFiles,o=l.selDrawImageIndex,u=l.selImageIndexes,d=l.imageSizes,h=l.drawStatus,S=l.shapes,b=l.selShapeIndex;return Object(N.jsxs)(s.a,{type:"flex",justify:"space-between",style:{padding:"8px 16px"},children:[Object(N.jsx)(i.a,{xs:3,children:Object(N.jsx)(je.a,{checked:-1!==u.indexOf(t),onChange:function(e){var a=new Set(Object(p.a)(u));e.target.checked?a.add(t):a.delete(t),c({type:E.SET_SEL_IMAGE_INDEXES,payload:{selImageIndexes:Object(p.a)(a)}})}})}),Object(N.jsx)(i.a,{xs:15,children:Object(N.jsx)("div",{title:a,onClick:function(){c({type:E.SET_SEL_SHAPE_INDEX,payload:{selShapeIndex:null}}),c({type:E.SET_SEL_DRAW_IMAGE_INDEX,payload:{selDrawImageIndex:t}})},className:"file-item-name",style:{color:t===o?"#ff4d4f":"#000000d9"},children:a})}),Object(N.jsx)(i.a,{xs:6,style:{textAlign:"end"},children:Object(N.jsxs)(ne.b,{children:[Object(N.jsx)(le.a,{size:"small",shape:"circle",title:S[t]?"Total labels: ".concat(S[t].length):"",onClick:function(){c({type:E.SET_XML_PREVIEW_BOX_STATUS,payload:{selPreviewIndex:t,xmlPreviewBoxVisible:!0}})},children:S[t]?S[t].length:""}),Object(N.jsx)(le.a,{type:"primary",danger:!0,size:"small",shape:"circle",title:"Delete file",icon:Object(N.jsx)(xe.a,{}),onClick:function(){var e=r.filter((function(e,a){return a!==t})),a=o;0===e.length?a=null:t<=o&&0!==o&&(a=o-1),c({type:E.SET_IMAGE_FILES,payload:{imageFiles:e,selDrawImageIndex:a,imageSizes:d.filter((function(e,a){return a!==t})),drawStatus:t===o?f:h,shapes:S.filter((function(e,a){return a!==t})),selShapeIndex:t===o?null:b}})}})]})})]})};var fe=function(){var e=H().state.imageFiles;return Object(N.jsx)(s.a,{type:"flex",justify:"start",style:{overflow:"auto"},children:e.map((function(e,t){return Object(N.jsx)(i.a,{xs:24,children:Object(N.jsx)(Ee,{index:t,name:e.name})},e.name)}))})},Oe=a(627),ye=a(634),_e=a(637);var ge=function(){var e=H(),t=e.state,a=e.dispatch,n=t.imageFiles,l=t.selDrawImageIndex,c=t.selImageIndexes,r=t.imageSizes,s=t.drawStatus,i=t.shapes,o=t.selShapeIndex,u=function(e){if(e||0!==c.length){var t=e?n.map((function(e,t){return t})):[];a({type:E.SET_SEL_IMAGE_INDEXES,payload:{selImageIndexes:t}})}},d=Object(N.jsxs)(Oe.a,{children:[Object(N.jsx)(Oe.a.Item,{children:Object(N.jsx)(le.a,{type:"text",size:"small",onClick:function(){return u(!0)},children:"Select All"})}),Object(N.jsx)(Oe.a.Item,{children:Object(N.jsx)(le.a,{type:"text",size:"small",onClick:function(){return u(!1)},children:"Select None"})}),Object(N.jsx)(Oe.a.Item,{children:Object(N.jsx)(le.a,{type:"text",size:"small",onClick:function(){if(0!==c.length){var e=n.filter((function(e,t){return-1===c.indexOf(t)})),t=i.filter((function(e,t){return-1===c.indexOf(t)})),u=r.filter((function(e,t){return-1===c.indexOf(t)})),d=l;0===e.length?d=null:-1!==c.indexOf(l)?d=0:c.forEach((function(e){e<l&&d--})),a({type:E.SET_IMAGE_FILES,payload:{imageFiles:e,selDrawImageIndex:d,imageSizes:u,drawStatus:-1===c.indexOf(l)?s:f,shapes:t,selShapeIndex:-1===c.indexOf(l)?o:null}})}},children:"Clear Select"})}),Object(N.jsx)(Oe.a.Item,{children:Object(N.jsx)(le.a,{type:"text",size:"small",onClick:function(){a({type:E.SET_IMAGE_FILES,payload:{imageFiles:[],selDrawImageIndex:null,imageSizes:[],drawStatus:f,shapes:[],selShapeIndex:null}})},children:"Clear All"})}),Object(N.jsx)(Oe.a.Item,{children:Object(N.jsx)(le.a,{type:"text",size:"small",onClick:function(){if(0!==c.length){var e=[],t=[];n.forEach((function(a,n){if(-1!==c.indexOf(n)){e.push(a);var l=$(a,r[n],i[n]);t.push(l)}})),ee(e,t)}else S.b.info("No images are selected.")},children:"Save Select"})}),Object(N.jsx)(Oe.a.Item,{children:Object(N.jsx)(le.a,{type:"text",size:"small",onClick:function(){if(0!==n.length){var e=n.map((function(e,t){return $(e,r[t],i[t])}));ee(n,e)}else S.b.info("No images are loaded.")},children:"Save All"})})]});return Object(N.jsx)(ye.a,{overlay:d,placement:"bottomRight",arrow:!0,children:Object(N.jsx)(_e.a,{})})},me=a(329),Te=a(328),Ie=a(638);var ve=function(e){var t=e.index,a=e.label,n=e.visible,l=H(),c=l.state,r=l.dispatch,o=c.selDrawImageIndex,u=c.shapes,d=c.selShapeIndex;return Object(N.jsxs)(s.a,{type:"flex",justify:"space-between",style:{padding:"8px 16px"},children:[Object(N.jsx)(i.a,{xs:14,children:Object(N.jsx)("div",{title:a,onClick:function(){r({type:E.SET_SEL_SHAPE_INDEX,payload:{selShapeIndex:t===d?null:t}})},className:"label-item-name",style:{color:t===d?"#ff4d4f":"#000000d9"},children:a})}),Object(N.jsx)(i.a,{xs:10,style:{textAlign:"end"},children:Object(N.jsxs)(ne.b,{children:[Object(N.jsx)(le.a,{size:"small",shape:"circle",title:n?"Hide label":"Show label",icon:n?Object(N.jsx)(me.a,{}):Object(N.jsx)(Te.a,{}),onClick:function(){var e=Object(x.cloneDeep)(u);e[o][t].visible=!e[o][t].visible,r({type:E.SET_SHAPES,payload:{shapes:e}}),t===d&&r({type:E.SET_SEL_SHAPE_INDEX,payload:{selShapeIndex:null}})}}),Object(N.jsx)(le.a,{type:"primary",size:"small",shape:"circle",title:"Edit label",icon:Object(N.jsx)(Ie.a,{}),onClick:function(){r({type:E.SET_CURRENT_SHAPE,payload:{currentShape:null}}),r({type:E.SET_SEL_SHAPE_INDEX,payload:{selShapeIndex:t}}),r({type:E.SET_LABELBOX_STATUS,payload:{selLabelType:a,labelBoxVisible:!0,labelBoxStatus:m}})}}),Object(N.jsx)(le.a,{type:"primary",danger:!0,size:"small",shape:"circle",title:"Delete label",icon:Object(N.jsx)(xe.a,{}),onClick:function(){var e=Object(x.cloneDeep)(u);e[o].splice(t,1),r({type:E.SET_SHAPES,payload:{shapes:e}}),t===d?r({type:E.SET_SEL_SHAPE_INDEX,payload:{selShapeIndex:null}}):t<d&&r({type:E.SET_SEL_SHAPE_INDEX,payload:{selShapeIndex:d-1}})}})]})})]})};var we=function(){var e=H().state,t=e.selDrawImageIndex,a=e.shapes;return Object(N.jsx)(s.a,{type:"flex",justify:"start",style:{overflow:"auto"},children:a[t]&&a[t].map((function(e,t){return Object(N.jsx)(i.a,{xs:24,children:Object(N.jsx)(ve,{index:t,label:e.label,visible:e.visible})},e.d)}))})};var Ae=function(){var e=H(),t=e.state,a=e.dispatch,n=t.selDrawImageIndex,l=t.shapes,c=t.selShapeIndex,r=function(e){if(0!==l[n].length){var t=Object(x.cloneDeep)(l);t[n]=t[n].map((function(t){if(t.visible===e)return t;var a=Object(x.cloneDeep)(t);return a.visible=e,a})),a({type:E.SET_SHAPES,payload:{shapes:t}}),c&&a({type:E.SET_SEL_SHAPE_INDEX,payload:{selShapeIndex:null}})}},s=Object(N.jsxs)(Oe.a,{children:[Object(N.jsx)(Oe.a.Item,{children:Object(N.jsx)(le.a,{type:"text",size:"small",onClick:function(){return r(!0)},children:"Show All"})}),Object(N.jsx)(Oe.a.Item,{children:Object(N.jsx)(le.a,{type:"text",size:"small",onClick:function(){return r(!1)},children:"Hide All"})}),Object(N.jsx)(Oe.a.Item,{children:Object(N.jsx)(le.a,{type:"text",size:"small",onClick:function(){0!==l[n].length&&a({type:E.DELETE_ALL_SHAPES})},children:"Clear All"})})]});return Object(N.jsx)(ye.a,{overlay:s,placement:"bottomRight",arrow:!0,children:Object(N.jsx)(_e.a,{})})},Le=be.a.Panel;var Pe=function(){var e=H().state,t=e.imageFiles,a=e.selDrawImageIndex,n=e.shapes;return Object(N.jsxs)(be.a,{bordered:!1,expandIconPosition:"left",defaultActiveKey:["file","label"],children:[Object(N.jsx)(Le,{header:"File List (".concat(t.length,")"),collapsible:"header",extra:Object(N.jsx)(ge,{}),children:Object(N.jsx)(fe,{})},"file"),Object(N.jsx)(Le,{header:null!==a?"Label List (".concat(n[a].length,")"):"Label List (0)",collapsible:"header",extra:Object(N.jsx)(Ae,{}),children:Object(N.jsx)(we,{})},"label")]})};var De=function(){var e=H().state,t=pe().state,a=e.imageFiles,n=e.selDrawImageIndex,l=e.drawStatus,c=e.imageSizes,r=t.mouseCoordinate;return Object(N.jsxs)(s.a,{type:"flex",justify:"space-between",align:"middle",gutter:[4,4],style:{height:"100%",width:"100%",padding:"0 4px"},children:[Object(N.jsx)(i.a,{children:"Status: ".concat(l)}),a[n]&&Object(N.jsx)(i.a,{children:"".concat(r.x," x ").concat(r.y," px / ").concat(c[n].width," x ").concat(c[n].height," px")})]})},Ce=a(629),Be=a(631),Re=a(626),ke=a(319),Me=a.n(ke);var Ne=function(){var e=H(),t=e.state,a=e.dispatch,l=t.selDrawImageIndex,c=t.currentShape,r=t.shapes,o=t.selShapeIndex,u=t.selLabelType,d=t.labelBoxStatus,h=t.labelBoxVisible,S=t.labelTypes,j=Object(n.useRef)(null),f=Object(n.useState)(!0),O=Object(b.a)(f,2),y=O[0],T=O[1],I=Object(n.useState)({left:0,top:0,bottom:0,right:0}),v=Object(b.a)(I,2),w=v[0],A=v[1];return Object(N.jsx)(Ce.a,{width:"300px",maskClosable:!1,title:Object(N.jsx)("div",{style:{width:"100%",cursor:"move"},onMouseOver:function(){T((function(e){return!e}))},onMouseOut:function(){T(!0)},onFocus:function(){},onBlur:function(){},children:"Label Box"}),visible:h,onOk:function(){if(u){var e=Object(x.cloneDeep)(r);if(d===g){var t=Object(x.cloneDeep)(c);t.paths.pop(),t.d=q(t.paths,!0),t.label=u,e[l]=[].concat(Object(p.a)(e[l]),[t])}else d===m&&(e[l][o].label=u);a({type:E.SET_SHAPES,payload:{shapes:e}}),a({type:E.SET_LABELBOX_STATUS,payload:{selLabelType:u,labelBoxVisible:!1,labelBoxStatus:_}}),a({type:E.SET_SEL_SHAPE_INDEX,payload:{selShapeIndex:null}}),new Set(S).has(u)||a({type:E.SET_LABEL_TYPES,payload:{labelTypes:[u].concat(Object(p.a)(S))}})}},onCancel:function(){a({type:E.SET_CURRENT_SHAPE,payload:{currentShape:null}}),a({type:E.SET_LABELBOX_STATUS,payload:{selLabelType:u,labelBoxVisible:!1,labelBoxStatus:_}}),a({type:E.SET_SEL_SHAPE_INDEX,payload:{selShapeIndex:null}})},modalRender:function(e){return Object(N.jsx)(Me.a,{disabled:y,bounds:w,onStart:function(e,t){return function(e,t){var a,n,l,c=null===(a=window)||void 0===a||null===(n=a.document)||void 0===n?void 0:n.documentElement,r=c.clientWidth,s=c.clientHeight,i=null===j||void 0===j||null===(l=j.current)||void 0===l?void 0:l.getBoundingClientRect();A({left:-(null===i||void 0===i?void 0:i.left)+(null===t||void 0===t?void 0:t.x),right:r-((null===i||void 0===i?void 0:i.right)-(null===t||void 0===t?void 0:t.x)),top:-(null===i||void 0===i?void 0:i.top)+(null===t||void 0===t?void 0:t.y),bottom:s-((null===i||void 0===i?void 0:i.bottom)-(null===t||void 0===t?void 0:t.y))})}(0,t)},children:Object(N.jsx)("div",{ref:j,children:e})})},okButtonProps:{disabled:!u},children:Object(N.jsxs)(s.a,{type:"flex",justify:"center",gutter:[8,12],children:[Object(N.jsx)(i.a,{xs:24,children:Object(N.jsx)(Be.a,{value:u,onChange:function(e){a({type:E.SET_SEL_LABEL_TYPE,payload:{selLabelType:e.target.value}})},allowClear:!0})}),Object(N.jsx)(i.a,{xs:24,children:Object(N.jsx)(Re.a,{size:"small",style:{maxHeight:"170px",overflow:"auto"},children:Object(N.jsx)(s.a,{type:"flex",justify:"center",gutter:[8,8],children:S.map((function(e){return Object(N.jsx)(i.a,{xs:24,className:"label-item",children:Object(N.jsxs)(s.a,{type:"flex",justify:"space-between",gutter:[8,8],children:[Object(N.jsx)(i.a,{xs:20,children:Object(N.jsx)("div",{title:e,onClick:function(){a({type:E.SET_SEL_LABEL_TYPE,payload:{selLabelType:e}})},className:"label-item-name",style:{width:"100%"},children:e})}),Object(N.jsx)(i.a,{xs:4,children:Object(N.jsx)(le.a,{danger:!0,type:"primary",size:"small",shape:"circle",title:"Delete label",icon:Object(N.jsx)(xe.a,{}),onClick:function(){return t=e,void a({type:E.SET_LABEL_TYPES,payload:{labelTypes:S.filter((function(e){return e!==t}))}});var t}})})]})},e)}))})})})]})})},Ue=Be.a.TextArea;var Xe=function(){var e=H(),t=e.state,a=e.dispatch,n=t.imageFiles,l=t.imageSizes,c=t.shapes,r=t.selPreviewIndex,s=t.xmlPreviewBoxVisible;return Object(N.jsx)(Ce.a,{width:"400px",maskClosable:!1,title:"XML Previw Box",visible:s,onOk:function(){!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label.xml",a=".xml",n=new Blob([e],{type:a}),l=document.createElement("a");l.download=t,l.href=window.URL.createObjectURL(n),l.dataset.downloadurl=[a,l.download,l.href].join(":"),l.click()}($(n[r],l[r],c[r]),"".concat(n[r].name.split(".")[0],".xml"))},onCancel:function(){a({type:E.SET_XML_PREVIEW_BOX_STATUS,payload:{selPreviewIndex:null,xmlPreviewBoxVisible:!1}})},okText:"Save",children:s&&Object(N.jsx)(Ue,{rows:10,value:$(n[r],l[r],c[r])})})},He=a(628),ze=He.a.Option;var Fe=function(){var e=H(),t=e.state,a=e.dispatch,l=t.imageFiles,c=t.selDrawImageIndex,r=t.imageSizes,o=t.drawStatus,u=t.shapes,j=t.selShapeIndex,x=t.urlBoxVisible,f=Object(n.useState)(null),O=Object(b.a)(f,2),y=O[0],_=O[1],g=Object(n.useState)(null),m=Object(b.a)(g,2),T=m[0],I=m[1],v=Object(n.useState)(null),w=Object(b.a)(v,2),L=w[0],P=w[1],D=Object(n.useState)(!1),C=Object(b.a)(D,2),B=C[0],R=C[1],k=function(){var e=Object(h.a)(d.a.mark((function e(){var t,n,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y&&T&&L){e.next=2;break}return e.abrupt("return");case 2:return R(!0),e.prev=3,e.next=6,V(y,"".concat(T,".").concat(L));case 6:t=e.sent,n=t.file,s=t.size,a({type:E.SET_IMAGE_FILES,payload:{imageFiles:[].concat(Object(p.a)(l),[n]),selDrawImageIndex:l.length?c:0,imageSizes:[].concat(Object(p.a)(r),[s]),drawStatus:o,shapes:[].concat(Object(p.a)(u),[[]]),selShapeIndex:j}}),S.b.success("Success to load ".concat(T,".").concat(L,".")),_(null),I(null),P(null),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(3),S.b.error("Failure to load ".concat(T,".").concat(L,".")),console.error(e.t0);case 20:R(!1);case 21:case"end":return e.stop()}}),e,null,[[3,16]])})));return function(){return e.apply(this,arguments)}}();return Object(N.jsx)(Ce.a,{width:"320px",title:"Image URL Box",maskClosable:!1,visible:x,confirmLoading:B,onOk:k,onCancel:function(){a({type:E.SET_URL_BOX_STATUS,payload:{urlBoxVisible:!1}})},okText:"Load",okButtonProps:{disabled:!(y&&T&&L)},children:x&&Object(N.jsxs)(s.a,{type:"flex",justify:"center",gutter:[8,8],children:[Object(N.jsx)(i.a,{xs:24,children:Object(N.jsx)(Be.a,{allowClear:!0,value:y,onChange:function(e){_(e.target.value)},placeholder:"Image URL"})}),Object(N.jsx)(i.a,{xs:24,children:Object(N.jsx)(Be.a,{allowClear:!0,value:T,onChange:function(e){I(e.target.value)},placeholder:"Image Name"})}),Object(N.jsx)(i.a,{xs:24,children:Object(N.jsx)(He.a,{value:L,onChange:function(e){P(e)},placeholder:"Image Type",style:{width:"100%"},children:A.map((function(e){return Object(N.jsx)(ze,{value:e,children:e.toUpperCase()},e)}))})})]})})};function Ge(e){var t=e.labelTypes,a=e.closePointRegion,l={imageFiles:[],selDrawImageIndex:null,selImageIndexes:[],imageSizes:[],drawStyle:K(0),drawStatus:f,selShapeType:T,currentShape:null,shapes:[],selShapeIndex:null,labelTypes:t,selLabelType:null,labelBoxStatus:_,labelBoxVisible:!1,selPreviewIndex:null,xmlPreviewBoxVisible:!1,urlBoxVisible:!1,closePointRegion:a},c=function(e){e.preventDefault()};return Object(n.useEffect)((function(){return document.addEventListener("contextmenu",c),function(){document.removeEventListener("contextmenu",c)}}),[]),Object(N.jsx)(X,{initialState:l,children:Object(N.jsx)(he,{initialState:{mouseCoordinate:{x:0,y:0}},children:Object(N.jsx)(s.a,{type:"flex",justify:"center",style:{height:"100%"},children:Object(N.jsx)(i.a,{xs:24,style:{height:"100%"},children:Object(N.jsxs)(s.a,{type:"flex",justify:"center",style:{height:"100%"},children:[Object(N.jsx)(i.a,{xs:24,md:3,style:{maxHeight:"100%",overflow:"auto"},children:Object(N.jsx)(re,{})}),Object(N.jsx)(i.a,{xs:24,md:16,style:{height:"100%"},children:Object(N.jsxs)(s.a,{type:"flex",justify:"center",style:{height:"100%"},children:[Object(N.jsx)(i.a,{xs:24,style:{height:"calc(100% - 30px)"},children:Object(N.jsx)(Se,{})}),Object(N.jsx)(i.a,{xs:24,style:{height:"30px"},children:Object(N.jsx)(De,{})})]})}),Object(N.jsx)(i.a,{xs:24,md:5,style:{maxHeight:"100%",overflow:"auto"},children:Object(N.jsx)(Pe,{})}),Object(N.jsx)(Ne,{}),Object(N.jsx)(Xe,{}),Object(N.jsx)(Fe,{})]})})})})})}Ge.defaultProps={labelTypes:[],closePointRegion:4};var We=Ge;a(622);var Ve=function(){return Object(N.jsx)("div",{className:"App",children:Object(N.jsx)(We,{labelTypes:["Dog","Cat"]})})},Ye=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,639)).then((function(t){var a=t.getCLS,n=t.getFID,l=t.getFCP,c=t.getLCP,r=t.getTTFB;a(e),n(e),l(e),c(e),r(e)}))};r.a.render(Object(N.jsx)(l.a.StrictMode,{children:Object(N.jsx)(Ve,{})}),document.getElementById("root")),Ye()}},[[623,1,2]]]);
//# sourceMappingURL=main.3b75c174.chunk.js.map